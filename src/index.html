<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ETH-A Dashboard Trend</title>
    <link rel="stylesheet" href="styles.css?v=20260210-2" />
  </head>
  <body>
    <div class="grid-sheen"></div>
    <div class="halo"></div>
    <div class="file-warning" id="fileWarning">
      请使用本地服务器启动（`npm run dev`），直接打开文件会导致模块加载失败。
    </div>

    <header class="masthead">
      <div>
        <div class="eyebrow">ETH-A / A 仪表盘 v2.0.1</div>
        <h1>Macro Gate · Risk Matrix · Trend Intelligence</h1>
        <p>战情级策略看板 · 全链路可审计 · 日度快照与历史趋势</p>
      </div>
      <div class="masthead-actions">
        <div class="view-toggle" aria-label="视图切换">
          <button id="viewPlainBtn" class="ghost view active" type="button">通俗</button>
          <button id="viewExpertBtn" class="ghost view" type="button">专家</button>
        </div>
        <button id="runBtn" class="cta">今日运行</button>
        <div class="last-run">Last Run: <span id="lastRun">--</span></div>
        <div class="run-status" id="runStatus">待运行</div>
      </div>
    </header>

    <main class="shell">
      <section class="panel run-bar" id="runBar">
        <div class="run-bar-header">
          <div>
            <div class="run-bar-title">运行状态</div>
            <div class="run-bar-sub">抓取 → 校验 → 计算 → 回放 → AI</div>
          </div>
          <div class="run-bar-meta" id="runMetaLeft">
            <div class="run-meta">
              <span>数据新鲜度（抓取）</span>
              <strong id="healthFreshness">--</strong>
            </div>
            <div class="run-meta">
              <span>缺失字段</span>
              <strong id="healthMissing">--</strong>
            </div>
            <div class="run-meta">
              <span>代理/网络</span>
              <strong id="healthProxy">--</strong>
            </div>
            <div class="run-meta">
              <span>AI 状态</span>
              <strong id="healthAi">--</strong>
            </div>
            <div class="run-meta">
              <span>数据时效（观测）</span>
              <strong id="healthTimeliness">--</strong>
            </div>
            <div class="run-meta">
              <span>发布门禁</span>
              <strong id="healthQuality">--</strong>
            </div>
            <div class="run-meta">
              <span>ETA</span>
              <strong id="etaValue">--</strong>
            </div>
          </div>
          <div class="run-bar-meta" id="runMetaRight">
            <div class="run-meta">
              <span>Run ID</span>
              <strong id="runMetaId">--</strong>
            </div>
            <div class="run-meta">
              <span>运行时间（本地）</span>
              <strong id="runMetaTime">--</strong>
            </div>
            <div class="run-meta">
              <span>数据时间（抓取）</span>
              <strong id="runMetaDataTime">--</strong>
            </div>
            <div class="run-meta">
              <span>来源</span>
              <strong id="runMetaSource">--</strong>
            </div>
            <div class="run-meta">
              <span>可信度</span>
              <strong id="runMetaTrust">--</strong>
            </div>
          </div>
        </div>
        <div class="run-bar-steps">
          <div class="run-step">
            <span>抓取</span>
            <strong id="runStageFetch">待运行</strong>
          </div>
          <div class="run-step">
            <span>校验</span>
            <strong id="runStageValidate">待运行</strong>
          </div>
          <div class="run-step">
            <span>计算</span>
            <strong id="runStageCompute">待运行</strong>
          </div>
          <div class="run-step">
            <span>回放</span>
            <strong id="runStageReplay">待运行</strong>
          </div>
          <div class="run-step">
            <span>AI</span>
            <strong id="runStageAi">待运行</strong>
          </div>
        </div>
      </section>

      <section class="panel timeline-panel">
        <div class="panel-title">时间轴总览</div>
        <div class="timeline-overview" id="timelineOverview"></div>
        <div class="timeline-tooltip" id="timelineTooltip">--</div>
        <div class="timeline-legend" id="timelineLegend"></div>
        <div class="timeline-track">
          <input type="range" id="timelineRange" min="0" max="0" value="0" />
          <div class="timeline-meta">
            <div class="timeline-label" id="timelineLabel">--</div>
            <button class="ghost" id="timelineLatestBtn">返回最新</button>
          </div>
        </div>
        <div class="history-track">
          <div class="history-title">历史日期轴（365天）</div>
          <input type="range" id="historyRange" min="0" max="0" value="0" />
          <div class="history-meta">
            <input type="date" id="historyDate" />
            <div class="history-hint" id="historyHint">选择日期将自动抓取并回放</div>
          </div>
        </div>
      </section>

      <section class="panel status-panel">
        <div class="status-core">
          <div class="status-pill" id="statusBadge">B</div>
          <div>
            <div class="status-title" id="statusTitle">B / 防守档</div>
            <div class="status-sub" id="statusSub">默认防守，等待确认</div>
          </div>
        </div>
        <div class="status-overview" id="statusOverview"></div>
        <div class="status-grid">
          <div class="stat">
            <div class="stat-label">β / β_cap</div>
            <div class="stat-value" id="betaValue">0.45 / 0.60</div>
          </div>
          <div class="stat">
            <div class="stat-label">对冲</div>
            <div class="stat-value" id="hedgeValue">OFF</div>
          </div>
          <div class="stat">
            <div class="stat-label">SC-Phase</div>
            <div class="stat-value" id="phaseValue">Up-Mid</div>
          </div>
          <div class="stat">
            <div class="stat-label">相位置信度</div>
            <div class="stat-value" id="confidenceValue">0.62</div>
          </div>
          <div class="stat">
            <div class="stat-label">极限重仓许可</div>
            <div class="stat-value" id="extremeValue">否</div>
          </div>
          <div class="stat">
            <div class="stat-label">分发闸门</div>
            <div class="stat-value" id="distributionValue">0 / 30D</div>
          </div>
        </div>
      </section>

      <section class="panel gate-audit-panel">
        <div class="panel-title">闸门链路 · 审计面板</div>
        <div class="gate-audit-grid">
          <div class="gate-chain" id="gateChain"></div>
          <div class="audit-visual" id="auditVisual"></div>
        </div>
      </section>

      <section class="panel action-panel">
        <div class="panel-title">行动映射 · 风险与反证</div>
        <div class="action-block">
          <div class="action-label">建议动作</div>
          <div class="action-value" id="actionSummary">--</div>
          <div class="action-sub" id="actionDetail">--</div>
        </div>
        <div class="action-block">
          <div class="action-label">反证条件</div>
          <div class="action-list" id="counterfactuals">--</div>
        </div>
        <div class="action-block">
          <div class="action-label">缺失影响</div>
          <div class="action-list" id="missingImpact">--</div>
        </div>
      </section>

      <section class="panel kanban">
        <div class="panel-title">状态看板</div>
        <div class="kanban-grid">
          <div class="kanban-col" data-state="A">
            <div class="kanban-head">A / 进攻档</div>
            <div class="kanban-body" id="kanbanA"></div>
          </div>
          <div class="kanban-col" data-state="B">
            <div class="kanban-head">B / 防守档</div>
            <div class="kanban-body" id="kanbanB"></div>
          </div>
          <div class="kanban-col" data-state="C">
            <div class="kanban-head">C / 避险档</div>
            <div class="kanban-body" id="kanbanC"></div>
          </div>
        </div>
      </section>

      <section class="panel gateflow">
        <div class="panel-title">闸门链路 · 逐步可审计</div>
        <div class="gate-track" id="gateList"></div>
      </section>

      <section class="panel inspector">
        <div class="panel-title">审计面板</div>
        <div id="gateInspector" class="inspector-body">
          <div class="inspector-empty">点击任意闸门，查看输入、来源与计算过程。</div>
        </div>
      </section>

      <section class="panel reasons">
        <div class="panel-title">证据摘要 · Top3 驱动</div>
        <ol id="topReasons" class="reason-list"></ol>
        <div class="panel-title">危险信号与结构注记</div>
        <div id="riskNotes" class="notes"></div>
        <div class="panel-title">证据提示</div>
        <div class="notes" id="evidenceHints">--</div>
      </section>

      <section class="panel ai-panel">
        <div class="panel-title">AI 解读</div>
        <div class="ai-status" id="aiStatus">AI 离线解读待机</div>
        <div id="aiPanel" class="ai-body"></div>
      </section>

      <section class="panel trend">
        <div class="panel-title">历史趋势</div>
        <div class="trend-grid">
          <div class="trend-card">
            <div class="trend-label">β 趋势</div>
            <div class="trend-chart" id="betaChart"></div>
            <div class="trend-meta" id="betaTrendMeta">反映仓位进攻/防守倾向，数值越高越进攻。</div>
          </div>
          <div class="trend-card">
            <div class="trend-label">置信度趋势</div>
            <div class="trend-chart" id="confidenceChart"></div>
            <div class="trend-meta" id="confidenceTrendMeta">反映当前判断稳定性，越高说明信号一致性越强。</div>
          </div>
          <div class="trend-card">
            <div class="trend-label">FoF 趋势</div>
            <div class="trend-chart" id="fofChart"></div>
            <div class="trend-meta" id="fofTrendMeta">反映流动性环境，偏低通常意味着资金面偏紧。</div>
          </div>
        </div>
      </section>

      <section class="panel eval-panel">
        <div class="panel-title">预测评估 · 发布门禁</div>
        <div id="evalPanel" class="eval-body"></div>
      </section>

      <section class="panel data-panel">
        <div class="panel-title">数据台 · 自动抓取与输入</div>
        <div class="workflow">
          <div class="workflow-step">
            <div class="workflow-label">抓取</div>
            <div class="workflow-value" id="workflowFetch">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">校验</div>
            <div class="workflow-value" id="workflowValidate">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">运行</div>
            <div class="workflow-value" id="workflowRun">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">回放</div>
            <div class="workflow-value" id="workflowReplay">待运行</div>
          </div>
        </div>
        <div class="data-actions">
          <span class="mode-pill">自动模式（本地历史优先 + 半衰期治理）</span>
          <label class="toggle">
            <span>运行日期</span>
            <input type="date" id="runDate" />
          </label>
          <button id="fetchBtn" class="ghost">自动抓取</button>
          <button id="forceFetchBtn" class="ghost">强制抓取</button>
        </div>
        <div id="sourceStatus" class="source-status"></div>
        <div id="inputError" class="input-error"></div>
        <div class="data-hint">
          规则：数据不完整将严格阻止运行。请先自动抓取，再补齐缺失项。
        </div>
        <div class="data-purpose">
          本区用于“抓取 + 校验 + 回填 + 导出”。系统默认自动抓取并优先使用本地历史补齐，
          同时对超半衰期字段执行拦截，避免过期数据污染判断。手动输入路径已默认关闭。
        </div>
        <textarea id="inputJson" class="data-textarea" rows="12" spellcheck="false" readonly></textarea>
        <div class="data-buttons">
          <button id="exportJsonBtn" class="ghost">导出 JSON</button>
          <button id="exportCsvBtn" class="ghost">导出 CSV</button>
        </div>
        <div class="panel-title">数据覆盖矩阵</div>
        <div id="coverageList" class="coverage-grid"></div>
        <div class="data-hint">点击闸门可追溯输入与规则命中。覆盖矩阵按闸门分组显示来源与用途。</div>
      </section>
    </main>

    <footer class="footer">
      <div>ETH-A Dashboard Trend · 本地运行 / 自动抓取</div>
      <button id="clearBtn" class="ghost">清空历史</button>
    </footer>

    <script>
      (function () {
        var warning = document.getElementById("fileWarning");
        if (window.location.protocol === "file:") {
          warning.style.display = "flex";
        }
      })();
    </script>
    <script type="module" src="app.js?v=20260210-2"></script>
  </body>
</html>
