<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ETH-A Dashboard Trend</title>
    <link rel="stylesheet" href="styles.css?v=20260202" />
  </head>
  <body>
    <div class="grid-sheen"></div>
    <div class="halo"></div>
    <div class="file-warning" id="fileWarning">
      请使用本地服务器启动（`npm run dev`），直接打开文件会导致模块加载失败。
    </div>

    <header class="masthead">
      <div>
        <div class="eyebrow">ETH-A / A 仪表盘 v2.0.1</div>
        <h1>Macro Gate · Risk Matrix · Trend Intelligence</h1>
        <p>战情级策略看板 · 全链路可审计 · 日度快照与历史趋势</p>
      </div>
      <div class="masthead-actions">
        <button id="runBtn" class="cta" onclick="window.__runToday__ && window.__runToday__()">今日运行</button>
        <div class="last-run">Last Run: <span id="lastRun">--</span></div>
        <div class="run-status" id="runStatus">待运行</div>
      </div>
    </header>

    <main class="shell">
      <section class="panel health-panel">
        <div class="health-grid" id="healthBar">
          <div class="health-item">
            <div class="health-label">数据新鲜度</div>
            <div class="health-value" id="healthFreshness">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">缺失字段</div>
            <div class="health-value" id="healthMissing">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">代理/网络</div>
            <div class="health-value" id="healthProxy">--</div>
          </div>
          <div class="health-item">
            <div class="health-label">AI 状态</div>
            <div class="health-value" id="healthAi">--</div>
          </div>
          <div class="health-item eta-card" id="etaCard">
            <div class="health-label">ETA</div>
            <div class="health-value" id="etaValue">--</div>
          </div>
        </div>
      </section>

      <section class="panel timeline-panel">
        <div class="panel-title">时间轴总览</div>
        <div class="timeline-overview" id="timelineOverview"></div>
        <div class="timeline-tooltip" id="timelineTooltip">--</div>
        <div class="timeline-legend" id="timelineLegend"></div>
        <div class="timeline-track">
          <input type="range" id="timelineRange" min="0" max="0" value="0" />
          <div class="timeline-meta">
            <div class="timeline-label" id="timelineLabel">--</div>
            <button class="ghost" id="timelineLatestBtn">返回最新</button>
          </div>
        </div>
        <div class="history-track">
          <div class="history-title">历史日期轴（365天）</div>
          <input type="range" id="historyRange" min="0" max="0" value="0" />
          <div class="history-meta">
            <input type="date" id="historyDate" />
            <div class="history-hint" id="historyHint">选择日期将自动抓取并回放</div>
          </div>
        </div>
      </section>

      <section class="panel status-panel">
        <div class="status-core">
          <div class="status-pill" id="statusBadge">B</div>
          <div>
            <div class="status-title" id="statusTitle">B / 防守档</div>
            <div class="status-sub" id="statusSub">默认防守，等待确认</div>
          </div>
        </div>
        <div class="status-overview" id="statusOverview"></div>
        <div class="status-detail state-A" id="statusDetailA"></div>
        <div class="status-detail state-B" id="statusDetailB"></div>
        <div class="status-detail state-C" id="statusDetailC"></div>
        <div class="overview-grid">
          <div class="overview-card">
            <div class="overview-label">当前动作</div>
            <div class="overview-value" id="overviewAction">--</div>
            <div class="overview-sub" id="overviewActionHint">--</div>
          </div>
          <div class="overview-card">
            <div class="overview-label">核心驱动</div>
            <div class="overview-value" id="overviewDrivers">--</div>
            <div class="overview-sub" id="overviewDriversHint">--</div>
          </div>
          <div class="overview-card">
            <div class="overview-label">风险阻断</div>
            <div class="overview-value" id="overviewBlocks">--</div>
            <div class="overview-sub" id="overviewBlocksHint">--</div>
          </div>
        </div>
        <div class="status-grid">
          <div class="stat">
            <div class="stat-label">β / β_cap</div>
            <div class="stat-value" id="betaValue">0.45 / 0.60</div>
          </div>
          <div class="stat">
            <div class="stat-label">对冲</div>
            <div class="stat-value" id="hedgeValue">OFF</div>
          </div>
          <div class="stat">
            <div class="stat-label">SC-Phase</div>
            <div class="stat-value" id="phaseValue">Up-Mid</div>
          </div>
          <div class="stat">
            <div class="stat-label">相位置信度</div>
            <div class="stat-value" id="confidenceValue">0.62</div>
          </div>
          <div class="stat">
            <div class="stat-label">极限重仓许可</div>
            <div class="stat-value" id="extremeValue">否</div>
          </div>
          <div class="stat">
            <div class="stat-label">分发闸门</div>
            <div class="stat-value" id="distributionValue">0 / 30D</div>
          </div>
        </div>
      </section>

      <section class="panel gate-audit-panel">
        <div class="panel-title">闸门链路 · 审计面板</div>
        <div class="gate-summary" id="gateSummary"></div>
        <div class="gate-audit-grid">
          <div class="gate-chain" id="gateChain"></div>
          <div class="audit-visual" id="auditVisual"></div>
        </div>
      </section>

      <section class="panel action-panel">
        <div class="panel-title">行动映射 · 风险与反证</div>
        <div class="action-block">
          <div class="action-label">建议动作</div>
          <div class="action-value" id="actionSummary">--</div>
          <div class="action-sub" id="actionDetail">--</div>
        </div>
        <div class="action-block">
          <div class="action-label">反证条件</div>
          <div class="action-list" id="counterfactuals">--</div>
        </div>
        <div class="action-block">
          <div class="action-label">缺失影响</div>
          <div class="action-list" id="missingImpact">--</div>
        </div>
      </section>

      <section class="panel kanban">
        <div class="panel-title">状态看板</div>
        <div class="kanban-grid">
          <div class="kanban-col" data-state="A">
            <div class="kanban-head">A / 进攻档</div>
            <div class="kanban-body" id="kanbanA"></div>
          </div>
          <div class="kanban-col" data-state="B">
            <div class="kanban-head">B / 防守档</div>
            <div class="kanban-body" id="kanbanB"></div>
          </div>
          <div class="kanban-col" data-state="C">
            <div class="kanban-head">C / 避险档</div>
            <div class="kanban-body" id="kanbanC"></div>
          </div>
        </div>
      </section>

      <section class="panel reasons">
        <div class="panel-title">证据摘要 · Top3 驱动</div>
        <ol id="topReasons" class="reason-list"></ol>
        <div class="panel-title">危险信号与结构注记</div>
        <div id="riskNotes" class="notes"></div>
        <div class="panel-title">证据提示</div>
        <div class="notes" id="evidenceHints">--</div>
      </section>

      <section class="panel ai-panel">
        <div class="panel-title">AI 解读</div>
        <div class="ai-status" id="aiStatus">AI 未连接</div>
        <div id="aiPanel" class="ai-body"></div>
      </section>

      <section class="panel trend">
        <div class="panel-title">历史趋势</div>
        <div class="trend-grid">
          <div class="trend-card">
            <div class="trend-label">β 趋势</div>
            <div class="trend-chart" id="betaChart"></div>
          </div>
          <div class="trend-card">
            <div class="trend-label">置信度趋势</div>
            <div class="trend-chart" id="confidenceChart"></div>
          </div>
          <div class="trend-card">
            <div class="trend-label">FoF 趋势</div>
            <div class="trend-chart" id="fofChart"></div>
          </div>
        </div>
      </section>

      <section class="panel data-panel">
        <div class="panel-title">数据台 · 自动抓取与输入</div>
        <div class="workflow">
          <div class="workflow-step">
            <div class="workflow-label">抓取</div>
            <div class="workflow-value" id="workflowFetch">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">校验</div>
            <div class="workflow-value" id="workflowValidate">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">运行</div>
            <div class="workflow-value" id="workflowRun">待运行</div>
          </div>
          <div class="workflow-step">
            <div class="workflow-label">回放</div>
            <div class="workflow-value" id="workflowReplay">待运行</div>
          </div>
        </div>
        <div class="data-actions">
          <label class="toggle">
            <span>运行日期</span>
            <input type="date" id="runDate" />
          </label>
          <button id="fetchBtn" class="ghost">自动抓取</button>
          <button class="ghost" onclick="window.__autoFetch__ && window.__autoFetch__()">强制抓取</button>
          <button id="templateBtn" class="ghost">插入模板</button>
          <button id="validateBtn" class="ghost">验证输入</button>
        </div>
        <div id="sourceStatus" class="source-status"></div>
        <div id="inputError" class="input-error"></div>
        <div class="data-hint">
          规则：数据不完整将严格阻止运行。请先自动抓取，再补齐缺失项。
        </div>
        <textarea id="inputJson" class="data-textarea" rows="12" spellcheck="false"></textarea>
        <div class="data-buttons">
          <button id="applyInputBtn" class="ghost">应用并运行</button>
          <button id="resetInputBtn" class="ghost">清空输入</button>
          <button id="exportJsonBtn" class="ghost">导出 JSON</button>
          <button id="exportCsvBtn" class="ghost">导出 CSV</button>
        </div>
        <div class="panel-title">数据覆盖矩阵</div>
        <div id="coverageList" class="coverage-grid"></div>
        <div class="data-hint">点击闸门可追溯输入与规则命中。覆盖矩阵按闸门分组显示来源与用途。</div>
      </section>
    </main>

    <footer class="footer">
      <div>ETH-A Dashboard Trend · 本地运行 / 自动抓取</div>
      <button id="clearBtn" class="ghost">清空历史</button>
    </footer>

    <script>
      (function () {
        var warning = document.getElementById("fileWarning");
        if (window.location.protocol === "file:") {
          warning.style.display = "flex";
        }
      })();
    </script>
    <script type="module" src="app.js?v=20260202"></script>
  </body>
</html>
